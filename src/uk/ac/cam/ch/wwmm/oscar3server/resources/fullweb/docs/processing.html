<html>
<head><title>Processing documents with Oscar3</title></head>
<body>
<h1>Processing documents with Oscar3</h1>
<p>There are numerous ways of getting documents into a form that Oscar3 can
process ("SciXML"), and then causing Oscar3 to process them. This document
details the most important methods.</p>
<h2>From the command line</h2>
<p>All invocations of Oscar3 should start with:
<tt>java -Xmx512m -jar oscar3-a5.jar</tt> - which, when run on its own, will
present a list of commands that can be used.</p>
<h3>Processing without a workspace</h3>
<p><tt>java -Xmx512m -jar oscar3-a5.jar Process input.txt output.xml</tt> will
take the file <tt>input.txt</tt> (make sure the filename ends in <tt>.txt</tt>
- it detects file type by the suffix), generate SciXML from it, process it and
produce an inline annotated XML, which it will save as <tt>output.xml</tt>.
This can also be used to process HTML files (ensuring that the filename ends in
<tt>.htm</tt> or <tt>.html</tt>) and SciXML files (<tt>.xml</tt>).</p>
<p>To change the output format, use <tt>SAF</tt> instead of <tt>Process</tt> to
get SAF XML, <tt>Data</tt> to get inline data annotated XML. Please note
that this is an inefficient way of using Oscar3, as the amount of time Oscar3
takes to start up can be much longer than the time taken to process a document.
Consider using the batch methods given below, or doing processing via
the server.</p>
<p><tt>java -Xmx512m -jar oscar3-a5.jar ProcessInto input/directory/ 
output/directory</tt> will take a directory full of files ending in 
<tt>.txt</tt>, <tt>.htm</tt>, <tt>.html</tt> or <tt>.xml</tt>, and produce
an output directory. For each file in the input directory, a subdirectory
will be created in the output directory, which should contain files called
<tt>source.xml</tt> (the original document converted to SciXML),
<tt>saf.xml</tt> (the SAF XML), <tt>markedup.xml</tt> (the inline XML) and
<tt>data.xml</tt> (the inline data XML).</p>
<p>There is also Cross-Processing, which is
explained in the <a href="crossprocess.html">Cross-Processing</a> help file.</p>
<h3>Processing with a workspace</h3>
<p><tt>java -Xmx512m -jar oscar3-a5.jar ImportAndProcess input/directory/</tt>
works like <tt>ProcessInto</tt>, except that the output will be in your 
workspace as a new directory with the same name as the input directory.</p>
<p><tt>java -Xmx512m -jar oscar3-a5.jar Import input/directory/</tt>
works as above, but the files are not processed: this only generates 
<tt>source.xml</tt> files.</p>
<p><tt>java -Xmx512m -jar oscar3-a5.jar ProcessInWorkspace
directory/in/workspace</tt> (re)processes a directory (and all subdirectories)
that is in your workspace - maybe one that was generated by the method
above.</p>
<h2>From the server</h2>
<h3>Feeding documents to the server via a form</h3>
<p>From the main server page, follow the "Process form" link, and follow the
instructions. This method is also useful for letting external programs use
Oscar3 functionality - you send your documents as an HTTP POST and get
XML back that way. Try looking at the HTML source of the Process form for
more details. You may process both plain text and HTML in this manner.</p>
<p>There is also a bookmarklet on the main server page. This looks like a
link but contains Javascript. By placing that link in your bookmarks, you can
click on that link and thus feed whatever you were viewing in your
web browser to the Oscar3 server.</p>
<h3>When viewing the workspace</h3>
<p>When viewing files in your workspace, via the "View Papers" link on the
server main page, you will see links at the top of the screen saying "reprocess
this directory". Clicking the link will reprocess all of the documents in
that directory and all subdirectories of that directory, all subsubdirectories
etc.</p>
<h3>Downloading from PubMed</h3>
<p>On the server main page there is a link: "PubMed". Follow it. You can then
type a search term in. This is a query that gets sent to the PubMed server - you
will want to try the query on
<a href="http://www.ncbi.nlm.nih.gov/sites/entrez?db=pubmed">PubMed itself</a>
first to see what it fetches. You will also need to provide a name, and how
many abstracts to fetch (a few hundred is often a good number). Oscar3 will
contact the PubMed server, retrieve the abstracts, make a subdirectory in your
workspace (with the name you gave), put SciXML versions of the abstracts in
the directories and process all of the abstracts. Be warned, this
will not respond instantly, so go and have a cup of coffee while you wait.</p>
<h2>Programmatically from Java</h2>
<h3>Very simple processing</h3>
<p>The simplest method of all works like this:</p>
<pre><tt>
	String input = "This is a piece of chemical text and contains words like acetone.";
	String output = Oscar3.stringToString(input);
</tt></pre>
<p>This generates a string serialisation of the inline XML output. This
method is simple, but lacks flexibility. More flexible methods are presented
below.</p>
<h3>A note about XML</h3>
<p>In Oscar3, XML processing is done via the
<a href="http://www.xom.nu/">XOM</a> API. This document does not cover the
basics of using XOM; instead, see the <a href="http://www.xom.nu/">XOM</a>
website. Note that all instances of <tt>Document</tt> in the examples refer to
<tt>nu.xom.Document</tt>.</p>
<h3>Generating SciXML</h3>
<p>You can generate (rudimentary) SciXML from plain text, thus:</p>
<pre><tt>
	String s = "This is a piece of chemical text and contains words like acetone.";
	Document doc = TextToSciXML.textToSciXML(s);
</tt></pre>
<p>You can also process HTML via plain text, thus:</p>
<pre><tt>
	String html = "&lt;html&gt;&lt;body&gt;This is &lt;i&gt;chemical&lt;/i&gt; HTML &amp;amp; contains acetone.&lt;/body&gt;&lt;/html&gt;";
	String s = HtmlCleaner.cleanHTML(html);
	Document doc = TextToSciXML.textToSciXML(s);	
</tt></pre>
<h3>Processing SciXML</h3>
<p>To do this you will want to use an OscarFlow object. Assuming you already
has a <tt>Document</tt> called <tt>doc</tt>:</p>
<pre><tt>
	OscarFlow oscarFlow = new OscarFlow(doc);
	oscarFlow.processFull();
	Document inlineXML = oscarFlow.getInlineXML();
	Document safXML = oscarFlow.getSafXML();
	Document dataXML = oscarFlow.getDataXML();
</tt></pre>
<p>If you don't want the data XML, then instead of <tt>processFull()</tt> try
<tt>processLite()</tt> - likewise, if you only want the SAF then use
<tt>processToSAF()</tt>. If you only want the data XML then try
<tt>parseData()</tt>. These three methods do a subset of the processing done by
<tt>processFull()</tt>. Advanced users can run sequences of OscarFlow commands
(documented <a href="flow.html">here</a>). For example if you aren't interested
in getting chemical structures, then this may be appropriate:</p>
<pre><tt>
	OscarFlow oscarFlow = new OscarFlow(doc);
	oscarFlow.runFlow("recognise numbersaf inline");
	Document inlineXML = oscarFlow.getInlineXML();
</tt></pre>
</body>
</html>